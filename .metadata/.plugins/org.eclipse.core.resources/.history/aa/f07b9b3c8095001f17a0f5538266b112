// Agregar un nuevo item al formulario
function agregarItem() {
    const itemsContainer = document.getElementById("itemsContainer");
    const itemDiv = document.createElement("div");

    itemDiv.innerHTML = `
        <div class="mb-3">
    <label for="productoCodigo" class="form-label">Producto Código:</label>
    <input type="number" class="form-control" name="productoCodigo" required>
</div>

<div class="mb-3">
    <label for="color" class="form-label">Color:</label>
    <input type="text" class="form-control" name="color" required>
</div>

<div class="mb-3">
    <label for="talle" class="form-label">Talle:</label>
    <input type="text" class="form-control" name="talle" required>
</div>

<div class="mb-3">
    <label for="cantidad" class="form-label">Cantidad:</label>
    <input type="number" class="form-control" name="cantidad" required>
</div>

<button type="button" class="btn btn-danger" onclick="eliminarItem(this)">Eliminar</button>

    `;

    itemsContainer.appendChild(itemDiv);
}

// Eliminar un producto del formulario
function eliminarItem(button) {
    const itemDiv = button.parentElement;
    itemDiv.remove();
}

// Manejar la creación de la orden de compra
document.getElementById("ordenCompraForm").addEventListener("submit", async function (event) {
    event.preventDefault();

    const tiendaId = parseInt(document.getElementById("tiendaId").value);

    const items = Array.from(document.getElementById("itemsContainer").children).map(itemDiv => {
        return {
            color: itemDiv.querySelector("input[name='color']").value,
            talle: itemDiv.querySelector("input[name='talle']").value,
            cantidad: parseInt(itemDiv.querySelector("input[name='cantidad']").value),
            producto: {
                codigo: parseInt(itemDiv.querySelector("input[name='productoCodigo']").value)
            }
        };
    });

    const ordenCompra = {
        tiendaId,
        itemsOrdenCompra: items
    };

    try {
        const response = await axios.post("http://localhost:8080/ordenes-compra", ordenCompra);
        alert("Orden de compra creada con éxito: " + JSON.stringify(response.data));
    } catch (error) {
        alert("Error al crear la orden de compra: " + (error.response ? error.response.data : error.message));
    }
});
